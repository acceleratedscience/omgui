import{d as K,Q,K as J,b as X,u as Y,a as Z,r as w,c as ee,G as te,o as se,w as ae,ai as le,aj as R,O as ie,f as $,g as oe,h as i,i as c,v as r,R as p,m as h,F as v,A as C,j as ne,t as f,q as S,k as g,H as b,n as ce,p as re,C as ue,D as de,E as fe}from"./main-qhI6opJF.js";const L=y=>(ue("data-v-56677be0"),y=y(),de(),y),me={key:0,class:"col-header"},pe=L(()=>r("div",{class:"col-body"},null,-1)),ve=["title","onClick"],he={class:"col-body"},ye=["title","onClick"],_e=["title","onClick"],ke=["data-type","data-ext","title","onClick","onDblclick"],we=["data-type","data-ext","title","onClick","onDblclick","x"],Ce={key:0,class:"empty"},Me={key:0,class:"col-split"},Se={key:0,class:"column file-preview"},ge=["title"],be={id:"file-preview"},Be={class:"soft"},Te=L(()=>r("br",null,null,-1)),xe={class:"column filler-right"},Ee={key:0,class:"col-header"},Fe=L(()=>r("div",{class:"col-body"},null,-1)),ze=K({__name:"FileBrowser",props:{isModal:{type:Boolean},modelValue:{}},emits:["update:modelValue"],setup(y,{emit:A}){const V=Q(),I=J(),P=X(),_=Y(),M=Z(),B=w(!1),l=w(null),d=w(null),T=w(null),j=w(null),q=A,m=y,N=ee(()=>m.isModal??V.headless);te(async()=>{B.value=!0,l.value=l.value?l.value:[],x(),m.isModal||window.addEventListener("popstate",x)}),se(()=>{B.value=!1,m.isModal||window.removeEventListener("popstate",x)}),ae(()=>V.workspace,(t,s)=>{t&&s&&k()});async function x(){await k();const s=(m.isModal&&m.modelValue!=null?m.modelValue:M.path.replace(/(^\/headless)?\/~(\/)?/,"")).split("/").filter(a=>!!a);for(const[a,o]of s.entries()){const e=s.slice(0,a+1).join("/");await k(e,o,a+1)}const n=M.hash.replace(/^#/,"");if(l.value&&n&&n.length>0){const a=l.value[l.value.length-1],e=a.files.concat(a.filesHidden).filter(u=>u.filename===n)[0];e?E(e,l.value.length):m.isModal||_.push({path:M.path,query:M.query})}}async function E(t,s,n=!1){const a=new RegExp("/?"+t.filename+"$"),o=t.path.replace(a,""),e=N.value?"/headless":"";m.isModal||_.push(e+"/~/"+o+"#"+t.filename),z(s-1),t.sel=!0,t.dispSize=le(t._meta.size),t.dispTimeCreated=R(t._meta.timeCreated),t.dispTimeEdited=R(t._meta.timeEdited),l.value&&l.value.splice(s),d.value=t,D()}function H(){d.value=null}function F(t){if(m.isModal)return;const s=t._meta.size,n=s&&s>3e6,a=s&&s>1e7,o=s&&s>2e7;if(n){const e=o?"20 MB":a?"10 MB":"3 MB";let u=o?"It may take up to several minutes to load.":a?"It may take a minute to load.":"It may take a few seconds to load.";u+=" Are you sure you want to continue?",I.confirm(u,{title:`This file is over ${e}`,primaryBtn:"Open",onSubmit:()=>{P.setForcedLoading(!0),_.push("/~/"+t.path)}})}else _.push("/~/"+t.path)}async function k(t="",s="",n=0,a=!1){if(!B.value)return;a&&(m.isModal?q("update:modelValue",t):_.push("/~/"+t)),n>0&&O(n-1,"dir",s);const o=await W(t);o&&(H(),l.value&&(l.value.splice(n),l.value[n]=o)),a&&D()}async function D(){await ie(),T.value&&(T.value.scrollLeft=9999999999999)}function O(t,s,n){if(z(t),l.value){const a=l.value[t],e=a.dirs.concat(a.dirsHidden).filter(u=>u.filename===n)[0];e&&(e.sel=!0)}}async function U(t,s){var n;((n=t.target)==null?void 0:n.tagName)!=="BUTTON"&&(l.value&&l.value.splice(s+1),z(s),H())}function z(t){l.value&&(l.value[t].dirs.forEach(s=>s.sel=!1),l.value[t].dirsHidden.forEach(s=>s.sel=!1),l.value[t].files.forEach(s=>s.sel=!1),l.value[t].filesHidden.forEach(s=>s.sel=!1))}async function W(t=""){if(!$)return;const{status:s,data:n,statusText:a}=await $.getFiles(t);if(s!==200){console.error(a);return}else return n}return(t,s)=>{const n=oe("cv-button");return i(),c("div",{id:"col-scroll-x",ref_key:"colScroll",ref:T},[r("div",{id:"col-wrap",class:p({modal:t.isModal})},[r("div",{class:p(["column filler-left",{headless:N.value}])},[t.isModal?h("",!0):(i(),c("div",me)),pe],2),(i(!0),c(v,null,C(l.value,(a,o)=>(i(),c(v,{key:o},[r("div",{class:"column",ref_for:!0,ref_key:"columns",ref:j},[t.isModal?h("",!0):(i(),c("div",{key:0,class:p(["col-header",{root:o==0}]),title:a.dirname,onClick:e=>U(e,o)},[o==0?(i(),c("button",{key:0,class:"btn-workspace",onClick:s[0]||(s[0]=e=>ne(I).display("ModalWorkspaces"))},f(a.dirname),1)):(i(),c(v,{key:1},[S(f(a.dirname),1)],64))],10,ve)),r("div",he,[(i(!0),c(v,null,C(a.dirsHidden,(e,u)=>(i(),c("div",{key:u,class:p(["dir hidden",{sel:e.sel}]),title:e.filename,onClick:()=>k(e.path,e.filename,o+1,!0)},[r("div",null,f(e.filename),1),(i(),g(b,{icon:"icn-caret-right",key:e.filename}))],10,ye))),128)),(i(!0),c(v,null,C(a.dirs,(e,u)=>(i(),c("div",{key:u,class:p(["dir",{sel:e.sel}]),title:e.filename,onClick:()=>k(e.path,e.filename,o+1,!0)},[r("div",null,f(e.filename),1),(i(),g(b,{icon:"icn-caret-right",key:e.filename}))],10,_e))),128)),(i(!0),c(v,null,C(a.filesHidden,(e,u)=>(i(),c("div",{key:u,class:p(["file hidden",{sel:e.sel}]),"data-type":e._meta.fileType,"data-ext":e._meta.ext,title:e.filename,onClick:()=>E(e,o+1,!0),onDblclick:G=>F(e)},[(i(),g(b,{icon:"icn-file-"+e._meta.fileType,key:String(e._meta.fileType)},null,8,["icon"])),r("div",null,f(e.filename),1)],42,ke))),128)),(i(!0),c(v,null,C(a.files,(e,u)=>(i(),c("div",{key:u,class:p(["file",{sel:e.sel}]),"data-type":e._meta.fileType,"data-ext":e._meta.ext,title:e.filename,onClick:()=>E(e,o+1,!0),onDblclick:G=>F(e),x:"icn-file-"+e._meta.fileType},[(i(),g(b,{icon:"icn-file-"+e._meta.fileType,key:String(e._meta.fileType)},null,8,["icon"])),r("div",null,f(e.filename),1)],42,we))),128)),a._meta.empty?(i(),c("div",Ce,"Empty directory")):h("",!0)])],512),l.value&&o<l.value.length-1||d.value?(i(),c("div",Me)):h("",!0)],64))),128)),d.value&&!t.isModal?(i(),c("div",Se,[r("div",{class:"col-header",title:d.value.filename},f(d.value.filename),9,ge),r("div",be,[r("b",null,f(d.value.filename),1),r("small",null,[r("i",null,f(d.value.dispSize),1),r("div",Be,[S(" Created: "+f(d.value.dispTimeCreated),1),Te,S(" Last edit: "+f(d.value.dispTimeEdited),1)]),ce(n,{size:"small",kind:"secondary",onClick:s[1]||(s[1]=a=>F(d.value))},{default:re(()=>[S("open")]),_:1})])])])):h("",!0),r("div",xe,[t.isModal?h("",!0):(i(),c("div",Ee)),Fe])],2)],512)}}}),Ve=fe(ze,[["__scopeId","data-v-56677be0"]]);export{Ve as default};
