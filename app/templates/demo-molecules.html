<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Molecule Visualization API Demo</title>
		<link rel="stylesheet" href="/static/animations.css">
		<link rel="stylesheet" href="/static/demo.css">
	</head>
	<body>
		<div class="container">
			<div class="demo-container">
				<div class="control-panel">
					<h1>Molecule Visualization API Demo</h1>
					<form id="molVisForm">
						<div class="example-section">
							<h4>Example SMILES</h4>
							<div class="example-buttons" id="exampleSmiles">
								<button
									class="example-btn"
									data-smiles="C1=CC=CC=C1"
								>
									Benzene
								</button>
								<button
									class="example-btn"
									data-smiles="CC(=O)OC1=CC=CC=C1C(=O)O"
								>
									Aspirin
								</button>
								<button
									class="example-btn"
									data-smiles="CN1C=NC2=C1C(=O)N(C(=O)N2C)C"
								>
									Caffeine
								</button>
								<button
									class="example-btn"
									data-smiles="C1=CC=C2C(=C1)C=CC3=CC=CC=C32"
								>
									Naphthalene
								</button>
								<button
									class="example-btn"
									data-smiles="Clc1cc(Cl)c(Cl)c(-c2c(Cl)c(Cl)cc(Cl)c2Cl)c1Cl"
								>
									PCB
								</button>
							</div>
							<br />
							<h4>Example Highlights (SMARTS)</h4>
							<div class="example-buttons" id="exampleHighlights">
								<button
									class="example-btn"
									data-highlight="c1ccccc1"
								>
									Benzene Ring
								</button>
								<button
									class="example-btn"
									data-highlight="C(=O)O"
								>
									Carboxylic Acid
								</button>
								<button
									class="example-btn"
									data-highlight="C(=O)OC"
								>
									Ester Group
								</button>
								<button class="example-btn" data-highlight="CN">
									Amine
								</button>
								<button class="example-btn" data-highlight="Cl">
									Chlorine
								</button>
							</div>
						</div>

						<div id="url-preview">
							URL will appear here
							<button class="copy-btn" id="copyUrlBtn">
								Copy
							</button>
						</div>

						<div class="btn-wrap">
							<button type="submit">Render Molecule</button>
							<button id="open-btn-1">Open URL</button>
							<button id="reset-btn-1">Reset Form</button>
						</div>

						<h3>Molecule Input</h3>
						<div class="form-group">
							<label for="smiles">SMILES String:</label>
							<input
								type="text"
								id="smiles"
								name="smiles"
								value="C1=CC=CC=C1"
								required
							/>
						</div>

						<div class="form-group">
							<label for="highlight"
								>Highlight Substructure (SMARTS):</label
							>
							<input
								type="text"
								id="highlight"
								name="highlight"
								placeholder="e.g., c1ccccc1"
							/>
						</div>

						<h3>Rendering Options</h3>
						<div class="form-group">
							<div class="checkbox-wrap">
								<input type="checkbox" id="d3" name="d3" />
								<label for="d3">Render in 3D</label>
							</div>
						</div>

						<div class="form-group">
							<div class="checkbox-wrap">
								<input
									type="checkbox"
									id="d3_rot_random"
									name="d3_rot_random"
									checked
								/>
								<label for="d3_rot_random"
									>Random 3D rotation if not specified</label
								>
							</div>
						</div>

						<div class="form-group">
							<div class="checkbox-wrap">
								<input type="checkbox" id="png" name="png" />
								<label for="png"
									>Render as PNG (instead of SVG)</label
								>
							</div>
						</div>

						<div class="form-group">
							<label for="width">Width (pixels):</label>
							<input
								type="number"
								id="width"
								name="width"
								value="800"
								min="100"
							/>
						</div>

						<div class="form-group">
							<label for="height">Height (pixels):</label>
							<input
								type="number"
								id="height"
								name="height"
								value="600"
								min="100"
							/>
						</div>

						<h3>3D Options</h3>
						<div class="form-group">
							<label for="d3_style">3D Style:</label>
							<select id="d3_style" name="d3_style">
								<option value="BALL_AND_STICK">
									BALL_AND_STICK
								</option>
								<option value="SPACEFILLING">
									SPACEFILLING
								</option>
								<option value="TUBE">TUBE</option>
								<option value="WIREFRAME">WIREFRAME</option>
							</select>
						</div>

						<div class="form-group">
							<label for="d3_look">3D Look:</label>
							<select id="d3_look" name="d3_look">
								<option value="CARTOON">CARTOON</option>
								<option value="GLOSSY">GLOSSY</option>
							</select>
						</div>

						<div class="form-group">
							<label for="d3_rot_x"
								>Rotation X (60° units):</label
							>
							<input
								type="number"
								id="d3_rot_x"
								name="d3_rot_x"
								placeholder="Optional"
							/>
						</div>

						<div class="form-group">
							<label for="d3_rot_y"
								>Rotation Y (60° units):</label
							>
							<input
								type="number"
								id="d3_rot_y"
								name="d3_rot_y"
								placeholder="Optional"
							/>
						</div>

						<div class="form-group">
							<label for="d3_rot_z"
								>Rotation Z (60° units):</label
							>
							<input
								type="number"
								id="d3_rot_z"
								name="d3_rot_z"
								placeholder="Optional"
							/>
						</div>

						<div class="btn-wrap">
							<button type="submit">Render Molecule</button>
							<button id="open-btn-2">Open URL</button>
							<button id="reset-btn-2">Reset Form</button>
						</div>
					</form>
				</div>

				<div class="preview-panel">
					<iframe
						id="previewFrame"
						title="Molecule Visualization"
					></iframe>
				</div>
			</div>
		</div>

		<script>
			document.addEventListener("DOMContentLoaded", () => {
				const form = document.getElementById("molVisForm")
				const urlPreview = document.getElementById("url-preview")
				const previewFrame = document.getElementById("previewFrame")
				const copyUrlBtn = document.getElementById("copyUrlBtn")
				const openBtn1 = document.getElementById("open-btn-1");
            	const openBtn2 = document.getElementById("open-btn-2");
				const resetBtn1 = document.getElementById("reset-btn-1")
				const resetBtn2 = document.getElementById("reset-btn-2")

				// Function to update the URL and preview
				function updatePreview() {
					const formData = new FormData(form)
					const params = new URLSearchParams()
					let smiles = ""

					for (const [key, value] of formData.entries()) {
						// Only add parameters with values or checkboxes that are checked
						if (key == "smiles") {
							smiles = value
						} else if (value === "on") {
							// For checkboxes, add them as boolean true
							params.append(key, "true")
						} else if (value && value.trim() !== "") {
							params.append(key, value)
						}
					}

					// Special handling for unchecked checkboxes that we want to explicitly set to false
					if (!formData.has("d3")) params.append("d3", "false");
					if (!formData.has("png")) params.append("png", "false");
					if (!formData.has("d3_rot_random")) {
						params.append("d3_rot_random", "false");
					}

					const url = `/raw/molecule/${smiles}?${params.toString()}`
					urlPreview.textContent = window.location.origin + url;
					urlPreview.appendChild(copyUrlBtn);

					// Update the iframe src
					previewFrame.src = url;
				}

				// Initially update the preview
				updatePreview()

				// Update on form submit
				form.addEventListener("submit", (e) => {
					e.preventDefault()
					updatePreview()
				})

				// Open URL buttons
				openBtn1.addEventListener("click", openUrl)
				openBtn2.addEventListener("click", openUrl)
				function openUrl(e) {
					const url = urlPreview.textContent.replace("Copy", "").trim()
					window.open(url)
				}

				// Update when inputs change (for real-time preview)
				form.addEventListener("input", () => {
					updatePreview()
				})

				// Reset button handler
				// Small delay to ensure form is reset first
				resetBtn1.addEventListener("click", () => {
					setTimeout(updatePreview, 10)
				})
				resetBtn2.addEventListener("click", () => {
					setTimeout(updatePreview, 10)
				})

				// Copy URL button
				copyUrlBtn.addEventListener("click", () => {
					const url = urlPreview.textContent
						.replace("Copy", "")
						.trim()
					navigator.clipboard.writeText(url).then(() => {
						const originalText = copyUrlBtn.textContent
						copyUrlBtn.textContent = "Copied!"
						setTimeout(() => {
							copyUrlBtn.textContent = originalText
						}, 2000)
					})
				})

				// Example SMILES buttons
				document
					.getElementById("exampleSmiles")
					.addEventListener("click", (e) => {
						if (e.target.classList.contains("example-btn")) {
							document.getElementById("smiles").value =
								e.target.dataset.smiles
							updatePreview()
						}
					})

				// Example Highlights buttons
				document
					.getElementById("exampleHighlights")
					.addEventListener("click", (e) => {
						if (e.target.classList.contains("example-btn")) {
							document.getElementById("highlight").value =
								e.target.dataset.highlight
							updatePreview()
						}
					})
			})
		</script>
	</body>
</html>
